# FluxHero Architecture

> **Note:** This file is auto-generated from codebase analysis.
> If it conflicts with FLUXHERO_REQUIREMENTS.md, follow REQUIREMENTS.
> Last generated: 2026-01-21

## System Overview

```
Frontend (Next.js/React)
         │
         ▼
    API Layer (FastAPI)
         │
         ├──────────────────────────────┐
         ▼                              ▼
  Strategy Engine                 Execution Engine
  ├─ Regime Detector             ├─ Broker Interface
  ├─ Dual Mode Strategy          ├─ Order Manager (TODO)
  └─ Noise Filter                └─ Position Sizer (TODO)
         │                              │
         ▼                              ▼
  Computation Layer               Risk Management
  ├─ Indicators (JIT)            ├─ Kill Switch (TODO)
  ├─ Adaptive EMA (KAMA)         └─ Position Limits (TODO)
  └─ Volatility
         │
         ▼
   Storage Layer
   ├─ SQLite (trades, positions)
   ├─ Parquet (market data cache)
   └─ Candle Buffer (memory)
```

## Module Status

| Module | Status | Location | Purpose |
|--------|--------|----------|---------|
| Computation | Done | `backend/computation/` | JIT indicators (EMA, KAMA, ATR) |
| Strategy | Done | `backend/strategy/` | Regime detection, dual-mode trading |
| Storage | Done | `backend/storage/` | SQLite, Parquet, buffer |
| Data | Done | `backend/data/` | API wrapper, WebSocket feed |
| Backtesting | Done | `backend/backtesting/` | Engine, fills, metrics |
| Execution | **In Progress** | `backend/execution/` | Order management |
| Risk | Not Started | `backend/risk/` | Kill switch, limits |
| API | Not Started | `backend/api/` | FastAPI server |
| Frontend | Partial | `frontend/` | Next.js dashboard |

## Key Patterns

- **Performance:** Numba @njit for tight loops (indicators)
- **I/O:** All API calls async (httpx, asyncio)
- **State:** SQLite operational, Parquet for cache
- **Data flow:** REST historical → WebSocket live → Strategy → Execution

## File Structure

```
fluxhero/
├── backend/
│   ├── computation/
│   │   ├── indicators.py      # EMA, RSI, ATR (Numba JIT)
│   │   ├── adaptive_ema.py    # KAMA implementation
│   │   └── volatility.py      # Volatility calculations
│   ├── strategy/
│   │   ├── regime_detector.py # ADX, R² regime detection
│   │   ├── dual_mode.py       # Trend/mean-reversion strategy
│   │   └── noise_filter.py    # Signal validation
│   ├── storage/
│   │   ├── sqlite_store.py    # Trade/position storage
│   │   ├── parquet_store.py   # Market data cache
│   │   └── candle_buffer.py   # In-memory buffer
│   ├── data/
│   │   └── fetcher.py         # Async API client
│   ├── backtesting/
│   │   ├── engine.py          # Backtest orchestrator
│   │   ├── fills.py           # Order fill simulation
│   │   └── metrics.py         # Performance calculations
│   ├── execution/             # IN PROGRESS
│   │   └── broker_interface.py # Abstract broker (done)
│   ├── risk/                  # TODO
│   └── api/                   # TODO
└── frontend/                  # Next.js React app
```

## For Current Work (Execution Module)

**Dependencies:**
- Reads from: Strategy (signals), Data (broker API)
- Writes to: Storage (trades), Risk (exposure)

**Key files to reference:**
- `broker_interface.py` - Base class pattern
- `fetcher.py` - Async client pattern
- `sqlite_store.py` - Storage pattern

---
*Auto-generated by context-system*
